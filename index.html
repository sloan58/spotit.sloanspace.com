<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spawt It!</title>
    <link href="/app.css" rel="stylesheet" />
  </head>
  <body class="bg-gray-900">
    <div class="text-red-500" style="display: none"></div>
    <main class="py-4" x-data="app()" x-init="init">
      <div class="container mx-auto px-4">
        <div class="flex justify-between mt-5">
          <div>
            <h1
              class="text-7xl text-center font-extrabold text-transparent bg-clip-text bg-gradient-to-br from-white to-purple-900"
            >
              Spawt It!
            </h1>
          </div>
          <div>
            <div class="relative z-0 w-full group mt-5">
              <input
                x-model="winningScore"
                type="text"
                name="floating_winning_score"
                class="block py-2.5 px-0 w-full text-sm text-blue-900 bg-transparent border-0 border-b-2 border-blue-300 appearance-none dark:text-white dark:border-blue-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                placeholder=" "
                required
              />
              <label
                for="floating_winning_score"
                class="font-extrabold absolute text-sm text-blue-500 dark:text-blue-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                >Winning Score:</label
              >
            </div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mt-8">
          <!-- Left Cards -->
          <div
            class="rounded-xl w-full bg-gradient-to-r p-1 from-[#7928ca] to-[#ff0080]"
          >
            <div
              class="block p-6 bg-white rounded-lg shadow-md dark:bg-gray-900 dark:border-gray-700"
            >
              <div class="grid grid-cols-4 gap-4" id="leftCards"></div>
            </div>
          </div>
          <!-- Right Cards -->
          <div
            class="rounded-xl w-full bg-gradient-to-r p-1 from-[#7928ca] to-[#ff0080]"
          >
            <div
              class="block p-6 bg-white rounded-lg shadow-md dark:bg-gray-900 dark:border-gray-700"
            >
              <div class="grid grid-cols-4 gap-4" id="rightCards"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js"
      defer
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.2/underscore-min.js"
      integrity="sha512-anTuWy6G+usqNI0z/BduDtGWMZLGieuJffU89wUU7zwY/JhmDzFrfIZFA3PY7CEX4qxmn3QXRoXysk6NBh5muQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      const storage = window.localStorage

      let optionsList = [
        'academic-cap',
        'adjustments',
        'annotation',
        'archive',
        'arrow-circle-down',
        'arrow-circle-left',
        'arrow-circle-right',
        'arrow-circle-up',
        'arrow-down',
        'arrow-left',
        'arrow-narrow-down',
        'arrow-narrow-left',
        'arrow-narrow-right',
        'arrow-narrow-up',
        'arrow-right',
        'arrow-sm-down',
        'arrow-sm-left',
        'arrow-sm-right',
        'arrow-sm-up',
        'arrow-up',
        'arrows-expand',
        'at-symbol',
        'backspace',
        'badge-check',
        'ban',
        'beaker',
        'bell',
        'book-open',
        'bookmark-alt',
        'bookmark',
        'briefcase',
        'cake',
        'calculator',
        'calendar',
        'camera',
        'cash',
        'chart-bar',
        'chart-pie',
        'chart-square-bar',
        'chat-alt-2',
        'chat-alt',
        'chat',
        'check-circle',
        'check',
        'chevron-double-down',
        'chevron-double-left',
        'chevron-double-right',
        'chevron-double-up',
        'chevron-down',
        'chevron-left',
        'chevron-right',
        'chevron-up',
        'chip',
        'clipboard-check',
        'clipboard-copy',
        'clipboard-list',
        'clipboard',
        'clock',
        'cloud-download',
        'cloud-upload',
        'cloud',
        'code',
        'cog',
        'collection',
        'color-swatch',
        'credit-card',
        'cube-transparent',
        'cube',
        'currency-bangladeshi',
        'currency-dollar',
        'currency-euro',
        'currency-pound',
        'currency-rupee',
        'currency-yen',
        'cursor-click',
        'database',
        'desktop-computer',
        'device-mobile',
        'device-tablet',
        'document-add',
        'document-download',
        'document-duplicate',
        'document-remove',
        'document-report',
        'document-search',
        'document-text',
        'document',
        'dots-circle-horizontal',
        'dots-horizontal',
        'dots-vertical',
        'download',
        'duplicate',
        'emoji-happy',
        'emoji-sad',
        'exclamation-circle',
        'exclamation',
        'external-link',
        'eye-off',
        'eye',
        'fast-forward',
        'film',
        'filter',
        'finger-print',
        'fire',
        'flag',
        'folder-add',
        'folder-download',
        'folder-open',
        'folder-remove',
        'folder',
        'gift',
        'globe-alt',
        'globe',
        'hand',
        'hashtag',
        'heart',
        'home',
        'identification',
        'inbox-in',
        'inbox',
        'information-circle',
        'key',
        'library',
        'light-bulb',
        'lightning-bolt',
        'link',
        'location-marker',
        'lock-closed',
        'lock-open',
        'login',
        'logout',
        'mail-open',
        'mail',
        'map',
        'menu-alt-1',
        'menu-alt-2',
        'menu-alt-3',
        'menu-alt-4',
        'menu',
        'microphone',
        'minus-circle',
        'minus-sm',
        'minus',
        'moon',
        'music-note',
        'newspaper',
        'office-building',
        'paper-airplane',
        'paper-clip',
        'pause',
        'pencil-alt',
        'pencil',
        'phone-incoming',
        'phone-missed-call',
        'phone-outgoing',
        'phone',
        'photograph',
        'play',
        'plus-circle',
        'plus-sm',
        'plus',
        'presentation-chart-bar',
        'presentation-chart-line',
        'printer',
        'puzzle',
        'qrcode',
        'question-mark-circle',
        'receipt-refund',
        'receipt-tax',
        'refresh',
        'reply',
        'rewind',
        'rss',
        'save-as',
        'save',
        'scale',
        'scissors',
        'search-circle',
        'search',
        'selector',
        'server',
        'share',
        'shield-check',
        'shield-exclamation',
        'shopping-bag',
        'shopping-cart',
        'sort-ascending',
        'sort-descending',
        'sparkles',
        'speakerphone',
        'star',
        'status-offline',
        'status-online',
        'stop',
        'sun',
        'support',
        'switch-horizontal',
        'switch-vertical',
        'table',
        'tag',
        'template',
        'terminal',
        'thumb-down',
        'thumb-up',
        'ticket',
        'translate',
        'trash',
        'trending-down',
        'trending-up',
        'truck',
        'upload',
        'user-add',
        'user-circle',
        'user-group',
        'user-remove',
        'user',
        'users',
        'variable',
        'video-camera',
        'view-boards',
        'view-grid-add',
        'view-grid',
        'view-list',
        'volume-off',
        'volume-up',
        'wifi',
        'x-circle',
        'x',
        'zoom-in',
        'zoom-out',
      ]

      function addIcon(id, icon) {
        fetch(`/svgs/${icon}.svg`)
          .then((r) => r.text())
          .then((text) => {
            el = document.getElementById(id)
            el.innerHTML =
              el.innerHTML +
              '<div class="flex justify-center">' +
              text +
              '</div>'
          })
          .catch(console.error.bind(console))
      }

      function app() {
        return {
          players: JSON.parse(storage.getItem('players')) || [],
          leftCards: [],
          rightCards: [],
          addingPlayer: false,
          newPlayerName: '',
          needsPointAssignment: true,
          hasWinner: false,
          winner: '',
          winningScore: JSON.parse(storage.getItem('winningScore')) || 10,
          init() {
            this.$watch('winningScore', (v) => {
              storage.setItem('winningScore', v)
            })
            this.shuffle()
          },
          saveNewPlayer() {
            this.players.push({
              name: this.newPlayerName,
              score: 0,
            })
            storage.setItem('players', JSON.stringify(this.players))
            this.addingPlayer = false
            this.newPlayerName = ''
          },
          cancelAddPlayer() {
            this.addingPlayer = false
            this.newPlayerName = ''
          },
          removePlayer(player) {
            this.players = _.reject(this.players, (p) => p.name === player)
            storage.setItem('players', JSON.stringify(this.players))
          },
          addPoint(player) {
            this.players = this.players.map((p) => {
              if (p.name === player) {
                p.score++
              }
              return p
            })
            _.each(this.players, (player) => {
              if (player.score >= this.winningScore) {
                this.hasWinner = true
                this.winner = player.name
                this.players = _.map(this.players, (player) => {
                  player.score = 0
                  return player
                })
              }
            })
            storage.setItem('players', JSON.stringify(this.players))
            this.needsPointAssignment = false
          },
          newGame() {
            this.hasWinner = false
            this.winner = ''
            this.needsPointAssignment = true
            shuffle()
          },
          shuffle() {
            let options = optionsList
            let match = _.sample(options)

            options = _.reject(options, (option) => option === match)
            this.leftCards = _.sample(options, 7)
            this.leftCards.push(match)
            this.leftCards = _.shuffle(this.leftCards)

            options = _.reject(options, (option) =>
              _.contains(this.leftCards, option)
            )
            this.rightCards = _.sample(options, 7)
            this.rightCards.push(match)
            this.rightCards = _.shuffle(this.rightCards)

            this.needsPointAssignment = true

            _.each(this.leftCards, (leftCard) => {
              addIcon('leftCards', leftCard)
            })

            _.each(this.rightCards, (rightCard) => {
              addIcon('rightCards', rightCard)
            })
          },
        }
      }
    </script>
  </body>
</html>
